# World Comm — 大规模协调

::: info 环境信息
- **PettingZoo 名称**: `simple_world_comm_v3`
- **智能体**: 4 Adversary (1 Leader + 3 Hunter) + 2 Prey
- **额外元素**: 食物、森林、障碍物
- **类型**: 大规模团队协调 + 通信广播
:::

## 游戏目标

这是**最复杂**的 MPE 环境，包含团队结构、角色分工和通信机制。

### Leader (领袖)
- **全局观测**: 能看到所有猎物的位置
- **广播**: 将猎物的绝对坐标通过通信通道传给 Hunter
- **可移动**: 也可以直接追捕猎物
- **动作维度**: 9 = 5 (运动) + 4 (通信: Prey0_X, Prey0_Y, Prey1_X, Prey1_Y)

### Hunter (猎手)
- **局部观测**: 只看到附近的智能体
- **接收通信**: 从 Leader 接收猎物坐标，用于远程追击
- **追击**: 全速追向猎物
- **动作维度**: 5 (纯运动)

### Prey (猎物)
- **观测**: 能看到威胁 (Hunter) 和食物位置
- **目标**: 逃离 Hunter，寻找食物
- **惩罚**: 被捕获或出界都有严重惩罚
- **动作维度**: 5 (纯运动)

## 观测空间

### Leader 观测

| 字段 | 含义 |
|:-----|:-----|
| `position`, `velocity` | 自身位置和速度 |
| `enemies[]` | 猎物的相对位置 |
| `teammates[]` | 猎手的相对位置 |
| `landmarks[]` | 地标/食物/障碍物 |

### Hunter 观测

| 字段 | 含义 |
|:-----|:-----|
| `position`, `velocity` | 自身位置和速度 |
| `enemies[]` | 可见猎物的相对位置 |
| `communication` | Leader 广播的猎物坐标 |
| `landmarks[]` | 附近地标 |

### Prey 观测

| 字段 | 含义 |
|:-----|:-----|
| `position`, `velocity` | 自身位置和速度 |
| `enemies[]` | 可见 Hunter 的相对位置 (威胁) |
| `partner` | 另一只猎物的相对位置 |
| `landmarks[]` | 食物和障碍物 |

## 动作空间

### Leader 动作 (9 维)

| 索引 | 含义 | 取值 |
|:----:|:-----|:----:|
| `a[0]` | No-Op | [0, 1] |
| `a[1]` | Left | [0, 1] |
| `a[2]` | Right | [0, 1] |
| `a[3]` | Down | [0, 1] |
| `a[4]` | Up | [0, 1] |
| `a[5]` | Prey0_X 坐标 | 任意浮点 |
| `a[6]` | Prey0_Y 坐标 | 任意浮点 |
| `a[7]` | Prey1_X 坐标 | 任意浮点 |
| `a[8]` | Prey1_Y 坐标 | 任意浮点 |

::: tip 通信维度
Leader 的通信维度 (a[5]-a[8]) **可以是负数或大于 1**，因为它们编码的是猎物的绝对坐标（地图范围 [-1, 1]）。
:::

### Hunter / Prey 动作 (5 维)

标准 5 维运动力向量。

## 奖励函数

| 角色 | 奖励 |
|:----:|:-----|
| Leader | 猎物被捕时获得奖励；领导成功狩猎的额外奖励 |
| Hunter | 捕获猎物时高奖励；团队协作奖励 |
| Prey | 存活和获取食物时奖励；被捕扣分 |

## 提示词策略

### Leader 策略
```
1. 保持位置以观察所有猎物
2. 持续广播猎物的绝对坐标
3. 战略性移动，切断猎物逃跑路线
4. 保持猎物在视野范围内以更新信息
```

### Hunter 策略
```
1. 远距离时: 跟随 Leader 广播的坐标追击
2. 近距离时: 直接全速追击可见猎物
3. 与其他 Hunter 配合包围猎物
4. 接近猎物时减速避免过冲
```

### Prey 策略
```
1. 尽早发现威胁，立即逃离
2. 优先存活，其次寻找食物
3. 利用障碍物和森林掩护
4. 避免角落，保持逃跑路线开放
5. 永不停止移动
```

## 物理约束

```
1. 互斥轴: 不能同时向左和向右移动
2. 互斥轴: 不能同时向上和向下移动
3. 决定性: 值 > 0.5 表示果断移动，避免微弱输入
4. 惯性: 速度缓慢衰减，加速度累积
5. 边界: Prey 必须严格保持在 [-1, 1] 内
```

## 运行方式

```bash
python world_comm.py
```
